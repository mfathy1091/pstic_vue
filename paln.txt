Case/Referrals
- use Referral it self


------------
PSW / All Referrals (with filter)
- use Records as you want to get a specific time range of each Referral



------------
Emergencies
- Use it directly and get beneficiarties and emergency_types from each emergency
- it has emergency_date field - use it to filter without using records and referrals


----------
Activities
- Use it directly and get beneficiarties and provided_service from each activity
- it has activity_date field - use it to filter without using records and referrals




----
STATUS HISTORY
=============
select
    pi.id as "intake id",
    pi.referral_date,
    pis.status_id,
    s.name,
    pis.from_date,
    pis.to_date
from ps_intakes pi
Join
    ps_intake_statuses pis on pi.id = pis.ps_intake_id
Join
    statuses s on pis.status_id = s.id
 Where 
    from_date <= '2022-03-30'
    And to_date >= '2022-03-1'



CURRENT STATUS
==============
select
    pi.referral_date,
    s.name
from ps_intakes pi
Join
    statuses s on pi.current_status_id = s.id
where
    referral_date >= '2022-03-01'
    and referral_date <= '2022-04-30'


CLIENT LIST
============
select
    ib.id,
    b.name,
    b.age, 
    n.name as nationality,
    sum (case when s.service_type_id = 1 then 1 else 0 end) as "PSS",
    sum (case when s.service_type_id = 2 then 1 else 0 end) as "Info Sharing",
    sum (case when s.service_type_id = 3 then 1 else 0 end) as "Basic Needs",
    sum (case when s.service_type_id = 4 then 1 else 0 end) as "Community Support",
    sum (case when s.service_type_id = 5 then 1 else 0 end) as "Housing Advocacy",
    count(s.id) as "services Total"
from beneficiaries b
join ps_intake_beneficiaries ib
    on b.id = ib.beneficiary_id
join ps_intakes i
    on ib.ps_intake_id = i.id
join nationalities n
    on b.nationality_id = n.id
join services s
    on b.id = s.beneficiary_id and i.id = s.ps_intake_id
group by ib.id



CLIENT LIST 2
==============
select
    i.id as "Intake ID",    
    n.name as "nationality",    
    b.name,
    s.id as "service id",
    st.name,
    case when s.service_type_id = 1 then 1 else 0 end as "PSS",
    case when s.service_type_id = 2 then 1 else 0 end as "Info Sharing",
    case when s.service_type_id = 3 then 1 else 0 end as "Basic Needs",
    case when s.service_type_id = 4 then 1 else 0 end as "Community Support",
    case when s.service_type_id = 5 then 1 else 0 end as "Housing Advocacy"

from beneficiaries b
join ps_intake_beneficiaries ib
    on b.id = ib.beneficiary_id
join ps_intakes i
    on ib.ps_intake_id = i.id
join nationalities n
    on b.nationality_id = n.id
join services s
    on b.id = s.beneficiary_id and i.id = s.ps_intake_id
join service_types st
    on s.service_type_id = st.id
Group by
    ib.beneficiary_id



STATUS
=========
select
    n.name,
    sum (case when b.age > 0 and b.age <= 5 and b.gender_id = '1' then 1 else 0 end) as "age_0_5_m",
        sum (case when b.age > 0 and b.age <= 5 and b.gender_id = '2' then 1 else 0 end) as age_0_5_f,
        sum (case when b.age >= 6 and b.age <= 9 and b.gender_id = '1' then 1 else 0 end) as age_6_9_m, 
        sum (case when b.age >= 6 and b.age <= 9 and b.gender_id = '2' then 1 else 0 end) as age_6_9_f,
        sum (case when b.age >= 10 and b.age <= 14 and b.gender_id = '1' then 1 else 0 end) as age_10_14_m, 
        sum (case when b.age >= 10 and b.age <= 14 and b.gender_id = '2' then 1 else 0 end) as age_10_14_f,
        sum (case when b.age >= 15 and b.age <= 17 and b.gender_id = '1' then 1 else 0 end) as age_15_17_m, 
        sum (case when b.age >= 15 and b.age <= 17 and b.gender_id = '2' then 1 else 0 end) as age_15_17_f,
        sum (case when b.age >= 18 and b.age <= 24 and b.gender_id = '1' then 1 else 0 end) as age_18_24_m, 
        sum (case when b.age >= 18 and b.age <= 24 and b.gender_id = '2' then 1 else 0 end) as age_18_24_f,
        sum (case when b.age >= 25 and b.age <= 49 and b.gender_id = '1' then 1 else 0 end) as age_25_49_m, 
        sum (case when b.age >= 25 and b.age <= 49 and b.gender_id = '2' then 1 else 0 end) as age_25_49_f,
        sum (case when b.age >= 50 and b.age <= 59 and b.gender_id = '1' then 1 else 0 end) as age_50_59_m, 
        sum (case when b.age >= 50 and b.age <= 59 and b.gender_id = '2' then 1 else 0 end) as age_50_59_f,
        sum (case when b.age >= 60 and b.gender_id = '1' then 1 else 0 end) as age_gt_60_m, 
        sum (case when b.age >= 60 and b.gender_id = '2' then 1 else 0 end) as age_gt_60_f,
        count(b.id) as total
from beneficiaries b
join ps_intake_beneficiaries ib
    on b.id = ib.beneficiary_id
join ps_intakes i
    on ib.ps_intake_id = i.id
join nationalities n
    on b.nationality_id = n.id
Group by nationality_id


